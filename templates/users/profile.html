{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-md-3">
        {% if profile_user.avatar %}
            <img src="{{ profile_user.avatar.url }}" alt="{{ profile_user.username }}'s avatar" class="img-fluid rounded-circle">
        {% endif %}
    </div>
    <div class="col-md-9">
        <h2>{{ profile_user.username }}</h2>
        <p><strong>{{ profile_user.followers.count }}</strong> followers | <strong>{{ profile_user.following.count }}</strong> following</p>
        {% if request.user.is_authenticated and request.user != profile_user %}
            {% if is_following %}
                <form action="{% url 'users:unfollow' profile_user.username %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-secondary">Unfollow</button>
                </form>
            {% else %}
                <form action="{% url 'users:follow' profile_user.username %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary">Follow</button>
                </form>
            {% endif %}
        {% endif %}
        <p class="mt-3">{{ profile_user.bio }}</p>
    </div>
</div>
<hr>
<h3>Posts by {{ profile_user.username }}</h3>
<div class="row">
    {% for post in profile_user.posts.all %}
        <div class="col-md-4">
            <div class="card mb-4">
                {% if post.images.first %}
                    <img src="{{ post.images.first.image.url }}" class="card-img-top" alt="...">
                {% endif %}
                <div class="card-body">
                    {% if post.tags.all %}
                      <div class="mb-2">
                        {% for tag in post.tags.all %}
                          <span class="badge bg-secondary me-1">{{ tag.name }}</span>
                        {% endfor %}
                      </div>
                    {% endif %}
                    <p class="card-text">{{ post.caption|truncatewords:10 }}</p>
                </div>
            </div>
        </div>
    {% endfor %}
</div>
{% endblock %}